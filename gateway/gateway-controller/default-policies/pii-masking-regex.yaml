name: pii-masking-regex
version: v0.3.0
description: |
  Masks or redacts Personally Identifiable Information (PII) in request and
  response payloads using configured regex patterns. Supports reversible
  masking and irreversible redaction modes.

parameters:
  type: object
  properties:
    email:
      type: boolean
      x-wso2-policy-advanced-param: false
      description: |
        Specifies whether built-in EMAIL detection is enabled.
      default: false
    phone:
      type: boolean
      x-wso2-policy-advanced-param: false
      description: |
        Specifies whether built-in PHONE detection is enabled.
      default: false
    ssn:
      type: boolean
      x-wso2-policy-advanced-param: false
      description: |
        Specifies whether built-in SSN detection is enabled.
      default: false
    customPIIEntities:
      type: array
      x-wso2-policy-advanced-param: true
      description: |
        Specifies custom PII entity definitions used for detection. Each item
        contains an entity name and the regex pattern used to match it.
      minItems: 1
      items:
        type: object
        properties:
          piiEntity:
            type: string
            description: Specifies the PII entity name, for example "EMAIL",
              "PHONE", or "SSN".
          piiRegex:
            type: string
            description: Specifies the regex pattern used to match the configured
              PII entity.
        required:
        - piiEntity
        - piiRegex
    jsonPath:
      type: string
      x-wso2-policy-advanced-param: true
      description: |
        Specifies the JSONPath used to extract the value to process. When
        empty, the entire payload is processed as plain text.
      default: "$.messages"
    redactPII:
      type: boolean
      x-wso2-policy-advanced-param: true
      description: |
        Specifies whether matched PII is permanently redacted as "*****"
        (true) or masked with reversible placeholders (false).
      default: false
  anyOf:
    - required:
      - customPIIEntities
    - required:
      - email
      properties:
        email:
          const: true
    - required:
      - phone
      properties:
        phone:
          const: true
    - required:
      - ssn
      properties:
        ssn:
          const: true

systemParameters:         
  type: object
  properties: {}
