name: basic-ratelimit
version: v0.8.1
description: |
  Enforces request rate limits by restricting how many requests are allowed
  within one or more configured time windows.

parameters:
  type: object
  additionalProperties: false
  required: ["limits"]
  properties:
    limits:
      type: array
      description: |
        Specifies one or more rate limits. All limits are evaluated, and the
        most restrictive result is enforced.
      minItems: 1
      maxItems: 10
      items:
        type: object
        additionalProperties: false
        required: ["requests", "duration"]
        properties:
          requests:
            type: integer
            description: Specifies the maximum number of requests allowed during
              the configured duration.
            minimum: 1
            maximum: 1000000000
          duration:
            type: string
            description: |
              Specifies the time window for the limit using Go duration format,
              for example "1s", "1m", "1h", or "24h".
            pattern: "^[0-9]+(ns|us|Âµs|ms|s|m|h)$"

systemParameters:
  type: object
  additionalProperties: false
  properties:
    algorithm:
      type: string
      description: |
        Rate limiting algorithm to use:
        - gcra: Generic Cell Rate Algorithm (default). Provides smooth rate limiting
          with burst support and token bucket semantics. Better for consistent traffic
          shaping and burst handling.
        - fixed-window: Simple fixed time window counter. Divides time into fixed
          intervals and counts requests per window. Lower computational overhead,
          but can allow up to 2x burst at window boundaries.
      enum: ["gcra", "fixed-window"]
      default: "gcra"
      "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.algorithm}"

    backend:
      type: string
      description: |
        Rate limit storage backend. 'memory' for in-memory storage (single-instance),
        'redis' for distributed rate limiting across multiple gateway instances.
      enum: ["memory", "redis"]
      default: "memory"
      "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.backend}"

    redis:
      type: object
      description: Redis configuration (only used when backend=redis)
      additionalProperties: false
      properties:
        host:
          type: string
          description: Redis server hostname or IP address
          default: "localhost"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.redis.host}"

        port:
          type: integer
          description: Redis server port
          minimum: 1
          maximum: 65535
          default: 6379
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.redis.port}"

        password:
          type: string
          description: Redis authentication password (optional)
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.redis.password}"

        username:
          type: string
          description: Redis ACL username (optional, Redis 6+)
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.redis.username}"

        db:
          type: integer
          description: Redis database number
          minimum: 0
          maximum: 15
          default: 0
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.redis.db}"

        keyPrefix:
          type: string
          description: Prefix for all Redis keys to avoid conflicts
          default: "ratelimit:v1:"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.redis.key_prefix}"

        failureMode:
          type: string
          description: |
            Behavior when Redis is unavailable. 'open' allows requests through,
            'closed' denies requests. Recommended: 'open' for availability.
          enum: ["open", "closed"]
          default: "open"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.redis.failure_mode}"

        connectionTimeout:
          type: string
          description: Redis connection timeout (Go duration string)
          default: "5s"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.redis.connection_timeout}"

        readTimeout:
          type: string
          description: Redis read timeout (Go duration string)
          default: "3s"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.redis.read_timeout}"

        writeTimeout:
          type: string
          description: Redis write timeout (Go duration string)
          default: "3s"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.redis.write_timeout}"

    memory:
      type: object
      description: In-memory storage configuration (only used when backend=memory)
      additionalProperties: false
      properties:
        maxEntries:
          type: integer
          description: |
            Maximum number of rate limit entries to store in memory.
            Oldest entries are evicted when limit is reached.
          minimum: 100
          maximum: 10000000
          default: 10000
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.memory.max_entries}"

        cleanupInterval:
          type: string
          description: |
            Interval for cleaning up expired entries (Go duration string).
            Use "0" to disable periodic cleanup.
          default: "5m"
          "wso2/defaultValue": "${config.policy_configurations.ratelimit_v0.memory.cleanup_interval}"
